<!doctype html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Học Kanji — Trang học tương tác</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#9aa6b2;--accent:#ffd166;--white:#f8fafc}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter, Roboto, Arial, sans-serif;background:linear-gradient(180deg,#071029,#0b1220);color:var(--white);min-height:100vh}
    .wrap{max-width:980px;margin:28px auto;padding:20px}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between}
    h1{margin:0;font-size:22px}
    p.lead{margin:4px 0 0;color:var(--muted)}
    .controls{display:flex;gap:8px;margin-top:16px}
    input.search{flex:1;padding:10px;border-radius:10px;border:0;background:#071528;color:var(--white)}
    button{background:var(--accent);border:0;padding:10px 12px;border-radius:10px;cursor:pointer;font-weight:600}
    main{display:grid;grid-template-columns:1fr 360px;gap:18px;margin-top:18px}
    .cards{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));padding:14px;border-radius:12px;min-height:130px;display:flex;flex-direction:column;justify-content:space-between}
    .kanji{font-size:52px;font-weight:700;line-height:1;color:var(--white)}
    .meta{display:flex;gap:8px;align-items:center;margin-top:8px}
    .chip{background:rgba(255,255,255,0.03);padding:6px 8px;border-radius:8px;color:var(--muted);font-size:13px}
    .hanviet{font-weight:700;color:var(--accent)}
    .examples{margin-top:8px;color:var(--muted);font-size:14px}
    aside{background:#06121a;padding:14px;border-radius:12px;height:fit-content}
    .panel h3{margin:0 0 8px 0}
    .toggle{display:flex;gap:8px;margin-bottom:10px}
    .toggle button{background:transparent;color:var(--white);border:1px solid rgba(255,255,255,0.04);padding:8px;border-radius:8px}
    .quiz{margin-top:10px}
    .question{font-size:18px;margin-bottom:10px}
    .options{display:flex;flex-direction:column;gap:8px}
    .opt{background:#071726;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);cursor:pointer}
    footer{margin-top:20px;color:var(--muted);font-size:13px}
    @media(max-width:880px){main{grid-template-columns:1fr}aside{order:2}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Học Kanji — Số 1–10</h1>
        <p class="lead">Bảng học tương tác: hiển thị Kanji, Hán‑Việt, On/Kun, ví dụ và chế độ quiz.</p>
      </div>
      <div style="text-align:right">
        <small style="color:var(--muted)">Tùy chỉnh nhanh</small>
        <div style="margin-top:6px">
          <button id="speakAll">Phát âm (JP)</button>
        </div>
      </div>
    </header>

    <div class="controls">
      <input class="search" id="search" placeholder="Tìm Kanji, Hán‑Việt, nghĩa... (ví dụ: Nhất, 四, しち)" />
      <button id="toggleReadings">Ẩn/Hiện đọc</button>
      <button id="startQuiz">Bắt đầu Quiz</button>
    </div>

    <main>
      <section>
        <div class="cards" id="cards"></div>
        <footer>
          Gợi ý: bấm vào một ô để nghe phát âm (nếu trình duyệt hỗ trợ giọng Nhật). Dùng nút Quiz để luyện nhớ.
        </footer>
      </section>

      <aside>
        <div class="panel">
          <h3>Bảng điều khiển</h3>
          <div class="toggle">
            <button id="showOnKun">On/Kun</button>
            <button id="showHanViet">Hán‑Việt</button>
            <button id="showExamples">Ví dụ</button>
          </div>

          <div class="quiz" id="quizBox">
            <h4 style="margin:6px 0">Quiz</h4>
            <div id="quizArea">
              <p class="question">Nhấn "Bắt đầu Quiz" để bắt đầu.</p>
            </div>
          </div>

        </div>
      </aside>
    </main>
  </div>

<script>
  // Dữ liệu Kanji 1-10
  const kanjiData = [
    {k:'一', han:'Nhất', on:['イチ','イツ'], kun:['ひとつ','ひと'], meaning:'Một', examples:['一人（ひとり）: một người','一日（いちにち）: một ngày']},
    {k:'二', han:'Nhị', on:['ニ'], kun:['ふたつ','ふた'], meaning:'Hai', examples:['二人（ふたり）: hai người','二月（にがつ）: tháng hai']},
    {k:'三', han:'Tam', on:['サン'], kun:['みっつ','み'], meaning:'Ba', examples:['三人（さんにん）: ba người','三日（みっか）: ngày mùng ba']},
    {k:'四', han:'Tứ', on:['シ'], kun:['よっつ','よん','よ'], meaning:'Bốn', examples:['四人（よにん）: bốn người','四月（しがつ）: tháng tư']},
    {k:'五', han:'Ngũ', on:['ゴ'], kun:['いつつ','いつ'], meaning:'Năm', examples:['五人（ごにん）: năm người','五月（ごがつ）: tháng năm']},
    {k:'六', han:'Lục', on:['ロク'], kun:['むっつ','むい','む'], meaning:'Sáu', examples:['六人（ろくにん）: sáu người','六日（むいか）: ngày mùng sáu']},
    {k:'七', han:'Thất', on:['シチ'], kun:['ななつ','なな'], meaning:'Bảy', examples:['七人（しちにん／ななにん）: bảy người','七月（しちがつ）: tháng bảy']},
    {k:'八', han:'Bát', on:['ハチ'], kun:['やっつ','や','よう'], meaning:'Tám', examples:['八人（はちにん）: tám người','八日（ようか）: ngày mùng tám']},
    {k:'九', han:'Cửu', on:['キュウ','ク'], kun:['ここのつ'], meaning:'Chín', examples:['九人（きゅうにん）: chín người','九日（ここのか）: ngày mùng chín']},
    {k:'十', han:'Thập', on:['ジュウ','ジッ'], kun:['とお','と'], meaning:'Mười', examples:['十人（じゅうにん）: mười người','十日（とおか）: ngày mười']}
  ];

  // --- Biến trạng thái
  let showOnKun = true, showHanViet = true, showExamples = true;
  const cardsEl = document.getElementById('cards');
  const searchEl = document.getElementById('search');
  const toggleReadingsBtn = document.getElementById('toggleReadings');
  const showOnKunBtn = document.getElementById('showOnKun');
  const showHanVietBtn = document.getElementById('showHanViet');
  const showExamplesBtn = document.getElementById('showExamples');
  const startQuizBtn = document.getElementById('startQuiz');
  const quizArea = document.getElementById('quizArea');
  const speakAllBtn = document.getElementById('speakAll');

  // --- Render Kanji cards
  function renderCards(filter=''){
    cardsEl.innerHTML='';
    const q = filter.trim().toLowerCase();
    kanjiData.filter(item=>{
      if(!q) return true;
      return [item.k,item.han,item.meaning,item.on.join(' '),item.kun.join(' '),...item.examples].join(' ').toLowerCase().includes(q);
    }).forEach(item=>{
      const div=document.createElement('div');
      div.className='card';
      div.innerHTML=`
        <div>
          <div class="kanji">${item.k}</div>
          ${showHanViet?`<div class="meta"><div class="chip hanviet">${item.han}</div><div class="chip">${item.meaning}</div></div>`:''}
          <div class="meta">${showOnKun?`<div class="chip">On: ${item.on.join(', ')}</div><div class="chip">Kun: ${item.kun.join(', ')}</div>`:''}</div>
          ${showExamples?`<div class="examples">${item.examples.join('<br>')}</div>`:''}
        </div>`;
      div.addEventListener('click',()=>speak(item.k));
      cardsEl.appendChild(div);
    });
  }

  // --- Phát âm
  function speak(text){
    if(!window.speechSynthesis) return alert('Trình duyệt không hỗ trợ Speech Synthesis');
    const utter=new SpeechSynthesisUtterance(text);
    const voices=window.speechSynthesis.getVoices();
    const jp=voices.find(v=>v.lang && v.lang.startsWith('ja'))||voices[0];
    if(jp) utter.voice=jp;
    utter.lang='ja-JP';
    window.speechSynthesis.cancel();
    window.speechSynthesis.speak(utter);
  }

  // --- Điều khiển hiển thị
  searchEl.addEventListener('input',e=>renderCards(e.target.value));
  toggleReadingsBtn.addEventListener('click',()=>{
    showOnKun=!showOnKun;showHanViet=!showHanViet;showExamples=!showExamples;renderCards(searchEl.value);
  });
  showOnKunBtn.addEventListener('click',()=>{showOnKun=!showOnKun;renderCards(searchEl.value);});
  showHanVietBtn.addEventListener('click',()=>{showHanViet=!showHanViet;renderCards(searchEl.value);});
  showExamplesBtn.addEventListener('click',()=>{showExamples=!showExamples;renderCards(searchEl.value);});
  speakAllBtn.addEventListener('click',()=>{
    let i=0;const t=setInterval(()=>{
      if(i>=kanjiData.length){clearInterval(t);return;}
      speak(kanjiData[i].k);i++;
    },900);
  });

  // --- Quiz logic (3 loại)
  let quizState=null;
  startQuizBtn.addEventListener('click',startQuiz);

  function startQuiz(){
    const pool=shuffleArray(kanjiData);
    quizState={pool,idx:0,score:0};
    renderQuestion();
  }

  function renderQuestion(){
    if(!quizState) return;
    const cur=quizState.pool[quizState.idx];
    const type=Math.floor(Math.random()*3); // 0: Kanji→Hán-Việt, 1: Ví dụ→nghĩa, 2: Điền Kanji
    let html='',correct='',choices=[];

    if(type===0){
      // Loại 1: Kanji → chọn Hán-Việt
      const others=pickN(kanjiData.filter(x=>x.k!==cur.k),3).map(x=>x.han);
      choices=shuffleArray([cur.han,...others]);
      correct=cur.han;
      html=`<p class="question">Chọn <b>Hán-Việt</b> đúng cho: <span style="font-size:32px">${cur.k}</span></p>`;
    }else if(type===1){
      // Loại 2: Ví dụ → chọn nghĩa đúng
      const ex=cur.examples[Math.floor(Math.random()*cur.examples.length)];
      const others=pickN(kanjiData.filter(x=>x.k!==cur.k),3).map(x=>x.meaning);
      choices=shuffleArray([cur.meaning,...others]);
      correct=cur.meaning;
      html=`<p class="question">Trong ví dụ: 「${ex.split(':')[0]}」<br>Chữ <b>${cur.k}</b> có nghĩa là gì?</p>`;
    }else{
      // Loại 3: Điền Kanji thích hợp
      const sentence=cur.examples[0].split(':')[0].replace(cur.k,'＿');
      const others=pickN(kanjiData.filter(x=>x.k!==cur.k),3).map(x=>x.k);
      choices=shuffleArray([cur.k,...others]);
      correct=cur.k;
      html=`<p class="question">Điền Kanji thích hợp: 「${sentence}」</p>`;
    }

    html+=`<div class="options">${choices.map((c,i)=>`<div class="opt" data-choice="${c}">${i+1}. ${c}</div>`).join('')}</div>
           <div style="margin-top:8px;color:var(--muted)">Câu ${quizState.idx+1}/${quizState.pool.length} — Điểm: ${quizState.score}</div>`;
    quizArea.innerHTML=html;
    document.querySelectorAll('.opt').forEach(el=>el.addEventListener('click',e=>onAnswer(e,correct)));
  }

  function onAnswer(e,correct){
    const selected=e.currentTarget.dataset.choice;
    if(selected===correct){
      quizState.score++;
      e.currentTarget.style.background='#083';
      e.currentTarget.style.borderColor='#6f6';
    }else{
      e.currentTarget.style.background='#300';
      e.currentTarget.style.borderColor='#f44';
    }
    // highlight đúng
    document.querySelectorAll('.opt').forEach(el=>{
      if(el.dataset.choice===correct) el.style.outline='2px solid rgba(255,222,122,0.5)';
    });
    quizState.idx++;
    setTimeout(()=>{
      if(quizState.idx>=quizState.pool.length){
        quizArea.innerHTML=`<p class="question">✅ Hoàn thành! Điểm: ${quizState.score}/${quizState.pool.length}</p>
                            <button id="retry">Chơi lại</button>`;
        document.getElementById('retry').addEventListener('click',startQuiz);
      }else renderQuestion();
    },900);
  }

  // --- Tiện ích
  function shuffle(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}}
  function shuffleArray(a){const r=a.slice();shuffle(r);return r;}
  function pickN(arr,n){const c=arr.slice();shuffle(c);return c.slice(0,n);}
  renderCards();
</script>

</body>
</html>
